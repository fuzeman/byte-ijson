[tox]
envlist = clean,py{26,27,33,34,35,36,37,py}-ij{python,yajl2,yajl2cffi},stats,flake8
skipsdist = True

[travis]
python =
  2.6: py26
  2.7: py27
  3.3: py33-ijpython
  3.4: py34-ijpython
  3.5: py35-ijpython
  3.6: py36-ijpython
  3.7: py37-ijpython
  pypy-5.4.1: pypy-ijpython
  pypy3.3-5.2-alpha1: pypy3-ijpython

[testenv]
deps =
  # backend requirements
  ijyajl: yajl-py<2.0.0

  ijyajl2: yajl-py{env:YAJL2_VERSION:>=2.0.0}

  ijyajl2cffi: cffi
  ijyajl2cffi: yajl-py{env:YAJL2_VERSION:>=2.0.0}

  # package requirements
  -r{toxinidir}/requirements.txt

  # test requirements
  -r{toxinidir}/tests/requirements.txt
setenv =
  ijpython: BACKEND=python
  ijyajl: BACKEND=yajl
  ijyajl2: BACKEND=yajl2
  ijyajl2cffi: BACKEND=yajl2_cffi
commands =
  python tox/install_dependencies.py
  py.test --cov-config .coveragerc --cov-append --cov=byte -m {env:BACKEND} {posargs}
passenv =
  BYTE_ENVIRONMENT
  TRAVIS_BUILD_ID
  TRAVIS_BRANCH

[testenv:clean]
skip_install = true
deps =
  coverage
commands =
  coverage erase

[testenv:flake8]
basepython = python
skip_install = true
deps =
  flake8
  flake8-docstrings>=0.2.7
  flake8-future-import>=0.4.3
  flake8-import-order>=0.9
  flake8-import-order-fuzeman>=1.6.0
commands =
  flake8 byte --config=flake8.ini
  flake8 tests --config=flake8.tests.ini

[testenv:stats]
skip_install = true
deps =
  coverage
commands =
  coverage report -m
  coverage html
